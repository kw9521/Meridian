<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meridian</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
  {% load static %}
  <link rel="stylesheet" href="{% static 'base.css' %}">
  <script type="text/javascript">
  function googleTranslateElementInit() {
      var userLang = navigator.language || navigator.userLanguage; // e.g. "fr", "es-US"
      userLang = userLang.split('-')[0]; 
      new google.translate.TranslateElement({
          pageLanguage: userLang
      }, 'google_translate_element');
  }
  </script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head>
<body>

<nav>
  <div class="nav-inner">
    <a href="/stocks/" class="logo"><div class="dot"></div>Meridian</a>
    <button class="menu-toggle" id="menuToggle">
      â˜°
    </button>
    <div class="nav-menu" id="navMenu">
      <div class="nav-links">
        <a href="/stocks/" class="nav-link {% block nav_market %}{% endblock %}">Market</a>
        <a href="/stocks/portfolio/" class="nav-link {% block nav_portfolio %}{% endblock %}">Portfolio</a>
        <a href="{% url 'about' %}" class="nav-link {% block nav_about %}{% endblock %}">About</a>
        <a href="/stocks/history/" class="nav-link {% block nav_history %}{% endblock %}">History</a>
        <a href="/leaderboard" class="nav-link {% block nav_leaderboard %}{% endblock %}">Leaderboard</a>
      </div>
      <div class="nav-right">
        <div class="search-wrap">
          <input class="search-input" id="searchInput" placeholder="Search company or ticker...">
          <div class="search-drop" id="searchDrop"></div>
        </div>
        <div id="google_translate_element"></div>
        <a href="/logout/" class="logout-btn">Sign out</a>
      </div>
    </div>
  </div>
</nav>

<!-- Welcome Banner -->
<div id="welcomeBanner" class="welcome-banner">
  <div class="welcome-inner">
    
    <div class="welcome-left">
      <div class="welcome-emoji">ðŸ‘‹</div>
      <div class="welcome-text">
        <div class="welcome-title">
          New to investing? You're in the right place.
        </div>
        <div class="welcome-sub">
          Meridian gives you <strong>$100,000 in virtual cash</strong> to practice trading real stocks â€” completely risk-free.
          Before you dive in, we recommend reading our beginner's guide.
        </div>
      </div>
    </div>

    <div class="welcome-actions">
      <a href="{% url 'gettingStarted' %}" class="welcome-cta">
        ðŸ“š Read the Guide â†’
      </a>
      <button class="welcome-skip">Skip for now</button>
      <button class="welcome-dismiss" title="Dismiss">âœ•</button>
    </div>

  </div>
</div>

<main>
  {% block content %}{% endblock %}
</main>

<script>
  // â”€â”€ Balance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  fetch('/stocks/api/user/').then(r=>r.json()).then(d=>{
    document.getElementById('navBalance').textContent = '$' + d.balance.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
  });

  // â”€â”€ Welcome Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // // Show banner unless user has dismissed it before
  // if (!localStorage.getItem('meridian_banner_dismissed')) {
  //   document.getElementById('welcomeBanner').style.display = 'block';
  // }
  // function dismissBanner() {
  //   document.getElementById('welcomeBanner').style.display = 'none';
  //   localStorage.setItem('meridian_banner_dismissed', '1');
  // }

  // â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let searchTimer;
  const inp = document.getElementById('searchInput');
  const drop = document.getElementById('searchDrop');
  const toggle = document.getElementById('menuToggle');
  const menu = document.getElementById('navMenu');

  toggle.addEventListener('click', () => {
    menu.classList.toggle('active');
  });
  inp.addEventListener('input', () => {
    clearTimeout(searchTimer);
    const q = inp.value.trim();
    if (!q) { drop.style.display='none'; return; }
    searchTimer = setTimeout(async () => {
      try {
        const res = await fetch(`/stocks/api/search/${encodeURIComponent(q)}/`);
        if (!res.ok) { drop.style.display='none'; return; }
        const d = await res.json();
        if (d.error) { drop.style.display='none'; return; }
        const pos = d.change_pct >= 0;
        drop.innerHTML = `<div class="search-item" onclick="window.location='/stocks/stock/${d.ticker}/'">
          <div>
            <div style="font-weight:700;font-family:var(--font-mono);font-size:13px;color:var(--text)">${d.ticker}</div>
            <div style="font-size:11px;color:var(--text2);margin-top:2px">${d.name}</div>
          </div>
          <div style="text-align:right">
            <div style="font-family:var(--font-mono);font-size:13px;color:var(--text)">$${d.current_price}</div>
            <div style="font-size:11px;color:${pos?'var(--green)':'var(--red)'}">${pos?'+':''}${d.change_pct}%</div>
          </div>
        </div>`;
        drop.style.display='block';
      } catch {
        drop.style.display='none';
      }
    }, 400);
  });
  document.addEventListener('click', e => { if (!e.target.closest('.search-wrap')) drop.style.display='none'; });
</script>
{% block scripts %}{% endblock %}
</body>
</html>