<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meridian</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:#080c10;--bg2:#0d1117;--bg3:#141b24;--bg4:#1c2633;
      --border:#1e2d3d;--border2:#243447;
      --text:#e6edf3;--text2:#8b949e;--text3:#484f58;
      --green:#3fb950;--green2:#238636;--green-glow:rgba(63,185,80,0.15);
      --red:#f85149;--red2:#da3633;--red-glow:rgba(248,81,73,0.15);
      --accent:#58a6ff;--accent2:#1f6feb;
      --font-mono:'Space Mono',monospace;--font-display:'Syne',sans-serif;
    }
    html,body{height:100%;background:var(--bg);color:var(--text);font-family:var(--font-display);-webkit-font-smoothing:antialiased;}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg2)}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes pulse-green{0%,100%{box-shadow:0 0 0 0 var(--green-glow)}50%{box-shadow:0 0 16px 4px var(--green-glow)}}
    .animate-in{animation:fadeIn 0.4s ease forwards}
    nav{background:rgba(8,12,16,0.95);border-bottom:1px solid var(--border);backdrop-filter:blur(12px);position:sticky;top:0;z-index:100;}
    .nav-inner{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;align-items:center;gap:24px;height:60px;}
    .logo{font-weight:800;font-size:20px;letter-spacing:-0.5px;color:var(--text);text-decoration:none;display:flex;align-items:center;gap:8px;}
    .dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:pulse-green 2s infinite;flex-shrink:0;}
    .nav-links{display:flex;gap:4px;}
    .nav-link{padding:6px 14px;border-radius:6px;font-weight:600;font-size:14px;cursor:pointer;border:none;background:transparent;color:var(--text2);text-decoration:none;transition:all 0.15s;}
    .nav-link:hover,.nav-link.active{background:var(--bg3);color:var(--text);}
    .nav-right{margin-left:auto;display:flex;align-items:center;gap:16px;}
    .balance-wrap{display:flex;flex-direction:column;align-items:flex-end;}
    .balance-label{font-size:10px;color:var(--text3);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:1px;}
    .balance-val{font-size:16px;font-weight:700;font-family:var(--font-mono);color:var(--green);}
    .search-wrap{position:relative;}
    .search-input{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:7px 12px;color:var(--text);font-family:var(--font-mono);font-size:13px;width:150px;outline:none;transition:border-color 0.2s;}
    .search-input:focus{border-color:var(--accent);}
    .search-drop{position:absolute;top:110%;left:0;background:var(--bg3);border:1px solid var(--border2);border-radius:8px;min-width:220px;z-index:200;display:none;box-shadow:0 8px 32px rgba(0,0,0,0.5);}
    .search-item{padding:10px 14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);}
    .search-item:hover{background:var(--bg4);}
    main{max-width:1200px;margin:0 auto;padding:28px 20px;}
    .logout-btn{padding:6px 14px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text2);cursor:pointer;font-family:var(--font-display);font-size:13px;font-weight:600;transition:all 0.15s;}
    .logout-btn:hover{background:var(--bg3);color:var(--text);}
  </style>
</head>
<body>
<nav>
  <div class="nav-inner">
    <a href="/stocks/" class="logo"><div class="dot"></div>Meridian</a>
    <div class="nav-links">
      <a href="/stocks/" class="nav-link {% block nav_market %}{% endblock %}">Market</a>
      <a href="/stocks/portfolio/" class="nav-link {% block nav_portfolio %}{% endblock %}">Portfolio</a>
      <a href="/stocks/history/" class="nav-link {% block nav_history %}{% endblock %}">History</a>
    </div>
    <div class="nav-right">
      <div class="search-wrap">
        <input class="search-input" id="searchInput" placeholder="Search company or ticker...">
        <div class="search-drop" id="searchDrop"></div>
      </div>
      <div class="balance-wrap">
        <span class="balance-label">Cash</span>
        <span class="balance-val" id="navBalance">â€”</span>
      </div>
      <a href="/logout/" class="logout-btn">Sign out</a>
    </div>
  </div>
</nav>
<main>
  {% block content %}{% endblock %}
</main>
<script>
  // Load balance
  fetch('/stocks/api/user/').then(r=>r.json()).then(d=>{
    document.getElementById('navBalance').textContent = '$' + d.balance.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
  });

  // Search
  let searchTimer;
  const inp = document.getElementById('searchInput');
  const drop = document.getElementById('searchDrop');
  inp.addEventListener('input', () => {
    clearTimeout(searchTimer);
    const q = inp.value.trim();
    if (!q) { drop.style.display='none'; return; }
    searchTimer = setTimeout(async () => {
      const res = await fetch(`/stocks/api/search/${q.toUpperCase()}/`);
      if (!res.ok) { drop.style.display='none'; return; }
      const d = await res.json();
      const pos = d.change_pct >= 0;
      drop.innerHTML = `<div class="search-item" onclick="window.location='/stocks/stock/${d.ticker}/'">
        <div><div style="font-weight:700;font-family:var(--font-mono);font-size:13px">${d.ticker}</div>
        <div style="font-size:11px;color:var(--text2);margin-top:2px">${d.name}</div></div>
        <div style="text-align:right">
          <div style="font-family:var(--font-mono);font-size:13px">$${d.current_price}</div>
          <div style="font-size:11px;color:${pos?'var(--green)':'var(--red)'}">${pos?'+':''}${d.change_pct}%</div>
        </div></div>`;
      drop.style.display='block';
    }, 400);
  });
  document.addEventListener('click', e => { if (!e.target.closest('.search-wrap')) drop.style.display='none'; });
</script>
{% block scripts %}{% endblock %}
</body>
</html>